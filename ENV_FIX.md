# ğŸ”§ ç¯å¢ƒå˜é‡é”™è¯¯ä¿®å¤æŒ‡å—

## âŒ é”™è¯¯ä¿¡æ¯

```
sqlalchemy.exc.ArgumentError: Expected string or URL object, got None
```

## ğŸ” é—®é¢˜åŸå› 

`DATABASE_URL` æ˜¯ `None`ï¼Œè¯´æ˜ï¼š
1. `.env` æ–‡ä»¶ä¸å­˜åœ¨
2. `.env` æ–‡ä»¶ä¸­æ²¡æœ‰ `database_url` é…ç½®
3. ç¯å¢ƒå˜é‡æ²¡æœ‰è¢«æ­£ç¡®åŠ è½½

## âœ… å¿«é€Ÿä¿®å¤

### æ–¹æ³• 1ï¼šåˆ›å»º `.env` æ–‡ä»¶ï¼ˆæ¨èï¼‰

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
cp env.example .env
```

ç„¶åç¼–è¾‘ `.env` æ–‡ä»¶ï¼Œç¡®ä¿è‡³å°‘æœ‰ä»¥ä¸‹é…ç½®ï¼š

```bash
# æ•°æ®åº“é…ç½®ï¼ˆå¿…éœ€ï¼‰
database_url=sqlite:///./test.db

# å…¶ä»–é…ç½®ï¼ˆå¯é€‰ï¼Œå·²æœ‰é»˜è®¤å€¼ï¼‰
broker_url=redis://localhost:6379/0
backend_url=redis://localhost:6379/0
local_model=./models/bert-base-chinese
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256
```

### æ–¹æ³• 2ï¼šä»£ç å·²æ·»åŠ é»˜è®¤å€¼ï¼ˆå·²ä¿®å¤ï¼‰

æˆ‘å·²ç»æ›´æ–°äº†ä»£ç ï¼Œç°åœ¨å¦‚æœ `.env` æ–‡ä»¶ä¸å­˜åœ¨ï¼Œä¼šä½¿ç”¨é»˜è®¤å€¼ï¼š
- `database_url`: `sqlite:///./test.db`
- `broker_url`: `redis://localhost:6379/0`
- `backend_url`: `redis://localhost:6379/0`
- ç­‰ç­‰...

ä½†æ˜¯**å¼ºçƒˆå»ºè®®**è¿˜æ˜¯åˆ›å»º `.env` æ–‡ä»¶ï¼Œå› ä¸ºï¼š
- ç”Ÿäº§ç¯å¢ƒéœ€è¦ä¸åŒçš„é…ç½®
- JWT å¯†é’¥éœ€è¦è®¾ç½®
- æ•°æ®åº“è·¯å¾„å¯èƒ½éœ€è¦è‡ªå®šä¹‰

## ğŸš€ éªŒè¯ä¿®å¤

### 1. æ£€æŸ¥ `.env` æ–‡ä»¶æ˜¯å¦å­˜åœ¨

```bash
ls -la .env
# åº”è¯¥èƒ½çœ‹åˆ° .env æ–‡ä»¶
```

### 2. æ£€æŸ¥ `.env` æ–‡ä»¶å†…å®¹

```bash
cat .env
# åº”è¯¥çœ‹åˆ° database_url=sqlite:///./test.db
```

### 3. é‡æ–°å¯åŠ¨åº”ç”¨

```bash
# å¦‚æœæ­£åœ¨è¿è¡Œï¼Œå…ˆåœæ­¢
# ç„¶åé‡æ–°å¯åŠ¨
uvicorn app.main:app --reload
```

## ğŸ“ å®Œæ•´çš„ `.env` æ–‡ä»¶ç¤ºä¾‹

```bash
# Celery é…ç½®
broker_url=redis://localhost:6379/0
backend_url=redis://localhost:6379/0

# æœ¬åœ°æ¨¡å‹è·¯å¾„ï¼ˆç”¨äº BERT é—®ç­”æ¨¡å‹ï¼‰
local_model=./models/bert-base-chinese

# æ•°æ®åº“é…ç½®ï¼ˆSQLiteï¼‰
database_url=sqlite:///./test.db

# JWT é…ç½®
SECRET_KEY=your-secret-key-here-change-in-production
ALGORITHM=HS256

# PyTorch/CUDA é…ç½®ï¼ˆå¦‚æœæ²¡æœ‰ GPUï¼Œè®¾ç½®ä¸ºç©ºå­—ç¬¦ä¸²å¼ºåˆ¶ä½¿ç”¨ CPUï¼‰
CUDA_VISIBLE_DEVICES=
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **`.env` æ–‡ä»¶ä¸åº”è¯¥æäº¤åˆ° Git**
   - å·²ç»åœ¨ `.gitignore` ä¸­æ’é™¤ï¼ˆåº”è¯¥ï¼‰
   - åŒ…å«æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ SECRET_KEYï¼‰

2. **ä½¿ç”¨ `env.example` ä½œä¸ºæ¨¡æ¿**
   - å¯ä»¥å®‰å…¨åœ°æäº¤åˆ° Git
   - å›¢é˜Ÿæˆå‘˜å¯ä»¥å‚è€ƒ

3. **è°ƒè¯•æ¨¡å¼ä¸‹ä¼šæ˜¾ç¤ºé…ç½®**
   - ä»£ç ç°åœ¨ä¼šæ‰“å° `Database URL` åˆ°æ—¥å¿—
   - å¯ä»¥å¸®åŠ©ç¡®è®¤é…ç½®æ˜¯å¦æ­£ç¡®åŠ è½½

## ğŸ” è°ƒè¯•æ­¥éª¤

å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

### 1. æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦åŠ è½½

åœ¨ Python æ§åˆ¶å°ä¸­ï¼š

```python
from app.core.config import settings
print(settings.database_url)
# åº”è¯¥è¾“å‡ºï¼šsqlite:///./test.db æˆ–ä½ çš„é…ç½®å€¼
```

### 2. æ£€æŸ¥ `.env` æ–‡ä»¶ä½ç½®

ç¡®ä¿ `.env` æ–‡ä»¶åœ¨é¡¹ç›®æ ¹ç›®å½•ï¼ˆä¸ `app/` ç›®å½•åŒçº§ï¼‰ï¼š

```
MyAgent/
â”œâ”€â”€ .env          â† åº”è¯¥åœ¨è¿™é‡Œ
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py
â”‚   â””â”€â”€ ...
â”œâ”€â”€ env.example
â””â”€â”€ ...
```

### 3. æ£€æŸ¥ `.env` æ–‡ä»¶æ ¼å¼

ç¡®ä¿æ ¼å¼æ­£ç¡®ï¼ˆæ²¡æœ‰å¤šä½™çš„ç©ºæ ¼ï¼Œä½¿ç”¨ `=` è€Œä¸æ˜¯ `:`ï¼‰ï¼š

```bash
# âœ… æ­£ç¡®
database_url=sqlite:///./test.db

# âŒ é”™è¯¯
database_url = sqlite:///./test.db  # ç­‰å·å‰åä¸è¦æœ‰ç©ºæ ¼ï¼ˆè™½ç„¶é€šå¸¸ä¹Ÿèƒ½å·¥ä½œï¼‰
database_url: sqlite:///./test.db   # åº”è¯¥ç”¨ = è€Œä¸æ˜¯ :
```

## ğŸ’¡ ä»£ç æ”¹è¿›è¯´æ˜

æˆ‘å·²ç»æ›´æ–°äº†ä»£ç ï¼Œåšäº†ä»¥ä¸‹æ”¹è¿›ï¼š

1. **æ·»åŠ äº†é»˜è®¤å€¼**ï¼šå¦‚æœç¯å¢ƒå˜é‡ä¸å­˜åœ¨ï¼Œä½¿ç”¨åˆç†çš„é»˜è®¤å€¼
2. **æ›´å¥½çš„é”™è¯¯å¤„ç†**ï¼šå¦‚æœ DATABASE_URL ä»ç„¶ä¸º Noneï¼Œä¼šç»™å‡ºæ¸…æ™°çš„é”™è¯¯ä¿¡æ¯
3. **æ—¥å¿—è®°å½•**ï¼šå¯åŠ¨æ—¶ä¼šæ‰“å° Database URLï¼Œæ–¹ä¾¿è°ƒè¯•

## ğŸ“š ç›¸å…³æ–‡ä»¶

- `app/core/config.py` - é…ç½®åŠ è½½ï¼ˆå·²æ·»åŠ é»˜è®¤å€¼ï¼‰
- `app/core/db.py` - æ•°æ®åº“åˆå§‹åŒ–ï¼ˆå·²æ·»åŠ éªŒè¯ï¼‰
- `env.example` - ç¯å¢ƒå˜é‡æ¨¡æ¿
- `.env` - ä½ çš„å®é™…é…ç½®ï¼ˆä¸åº”è¯¥æäº¤åˆ° Gitï¼‰

