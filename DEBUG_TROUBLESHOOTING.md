# ğŸ”§ è°ƒè¯•è¿æ¥é—®é¢˜æ’æŸ¥

## âŒ é”™è¯¯ï¼š`connect ECONNREFUSED 127.0.0.1:5678`

è¿™ä¸ªé”™è¯¯è¡¨ç¤ºè°ƒè¯•å™¨æ— æ³•è¿æ¥åˆ°ç«¯å£ 5678ã€‚

---

## ğŸ” æ•…éšœæ’é™¤æ­¥éª¤

### æ­¥éª¤ 1ï¼šæ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ debugpy æ˜¯å¦åœ¨è¿è¡Œ

**åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼š**

```bash
# SSH åˆ°è¿œç¨‹æœåŠ¡å™¨
ssh root@192.168.189.246 -p 20022

# æ£€æŸ¥ç«¯å£ 5678 æ˜¯å¦åœ¨ç›‘å¬
netstat -tuln | grep 5678
# æˆ–
ss -tuln | grep 5678
# æˆ–
lsof -i :5678
```

**é¢„æœŸç»“æœ**ï¼šåº”è¯¥çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„è¾“å‡º
```
tcp        0      0 0.0.0.0:5678            0.0.0.0:*               LISTEN
```

**å¦‚æœæ²¡æœ‰è¾“å‡º**ï¼šè¯´æ˜ debugpy æ²¡æœ‰å¯åŠ¨ï¼Œç»§ç»­æ­¥éª¤ 2ã€‚

---

### æ­¥éª¤ 2ï¼šç¡®è®¤åº”ç”¨æ˜¯å¦ä»¥è°ƒè¯•æ¨¡å¼å¯åŠ¨

**æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„è¿›ç¨‹ï¼š**

```bash
# æŸ¥çœ‹æ˜¯å¦æœ‰ Python è¿›ç¨‹åœ¨è¿è¡Œ
ps aux | grep python
ps aux | grep uvicorn
ps aux | grep start_with_debug
```

**å¦‚æœåº”ç”¨æ²¡æœ‰è¿è¡Œï¼ŒæŒ‰ä»¥ä¸‹æ–¹å¼å¯åŠ¨ï¼š**

```bash
cd /root/MyAgent

# æ–¹æ³•1ï¼šä½¿ç”¨è°ƒè¯•å¯åŠ¨è„šæœ¬ï¼ˆæ¨èï¼‰
export ENABLE_REMOTE_DEBUG=1
python start_with_debug.py

# æ–¹æ³•2ï¼šæ‰‹åŠ¨å¯åŠ¨å¹¶å¯ç”¨è°ƒè¯•
python -c "
import debugpy
debugpy.listen(('0.0.0.0', 5678))
print('Debugpy listening on 5678')
import uvicorn
uvicorn.run('app.main:app', host='0.0.0.0', port=8000)
"

# æ–¹æ³•3ï¼šç›´æ¥åœ¨ä»£ç ä¸­å¯ç”¨ï¼ˆä¸´æ—¶æ–¹æ¡ˆï¼‰
# åœ¨ app/main.py å¼€å¤´æ·»åŠ ï¼š
# import debugpy
# debugpy.listen(('0.0.0.0', 5678))
```

**å¯åŠ¨åï¼Œä½ åº”è¯¥çœ‹åˆ°ï¼š**
```
ğŸ”§ å¯ç”¨è¿œç¨‹è°ƒè¯•ï¼Œç›‘å¬ç«¯å£ 5678...
ğŸš€ å¯åŠ¨ FastAPI åº”ç”¨...
```

---

### æ­¥éª¤ 3ï¼šæ£€æŸ¥ SSH ç«¯å£è½¬å‘

**åœ¨æœ¬åœ°ï¼ˆä½ çš„ç”µè„‘ï¼‰æ‰§è¡Œï¼š**

```bash
# æ£€æŸ¥ SSH éš§é“æ˜¯å¦å»ºç«‹
ps aux | grep "5678:localhost:5678"
# æˆ–
lsof -i :5678
```

**å¦‚æœæ²¡æœ‰è¾“å‡º**ï¼Œè¯´æ˜ SSH éš§é“æ²¡æœ‰å»ºç«‹ã€‚é‡æ–°å»ºç«‹ï¼š

```bash
# å»ºç«‹ SSH ç«¯å£è½¬å‘
ssh -f -N -L 5678:localhost:5678 root@192.168.189.246 -p 20022

# éªŒè¯éš§é“æ˜¯å¦å»ºç«‹
ps aux | grep "5678:localhost:5678"
# åº”è¯¥çœ‹åˆ° SSH è¿›ç¨‹
```

**å¦‚æœæœ‰å¤šä¸ª SSH éš§é“ï¼Œå…ˆæ¸…ç†ï¼š**

```bash
# åœæ­¢æ‰€æœ‰ç›¸å…³çš„ SSH éš§é“
pkill -f "5678:localhost:5678"

# ç„¶åé‡æ–°å»ºç«‹
ssh -f -N -L 5678:localhost:5678 root@192.168.189.246 -p 20022
```

---

### æ­¥éª¤ 4ï¼šæµ‹è¯•æœ¬åœ°ç«¯å£è¿æ¥

**åœ¨æœ¬åœ°æµ‹è¯•ç«¯å£æ˜¯å¦å¯è®¿é—®ï¼š**

```bash
# æµ‹è¯•æœ¬åœ° 5678 ç«¯å£
telnet localhost 5678
# æˆ–
nc -zv localhost 5678
# æˆ–ä½¿ç”¨ Python
python3 -c "import socket; s = socket.socket(); s.connect(('localhost', 5678)); print('Connected!')"
```

**å¦‚æœè¿æ¥æˆåŠŸ**ï¼šè¯´æ˜ SSH éš§é“å·¥ä½œæ­£å¸¸ï¼Œé—®é¢˜å¯èƒ½åœ¨ Cursor é…ç½®ã€‚

**å¦‚æœè¿æ¥å¤±è´¥**ï¼šæ£€æŸ¥æ­¥éª¤ 3 çš„ SSH éš§é“ã€‚

---

### æ­¥éª¤ 5ï¼šæ£€æŸ¥é˜²ç«å¢™

**åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ£€æŸ¥é˜²ç«å¢™ï¼š**

```bash
# Ubuntu/Debian
sudo ufw status
sudo ufw allow 5678/tcp  # å¦‚æœéœ€è¦

# CentOS/RHEL
sudo firewall-cmd --list-ports
sudo firewall-cmd --add-port=5678/tcp --permanent
sudo firewall-cmd --reload

# æˆ–è€…ï¼Œå¦‚æœä½¿ç”¨ SSH éš§é“ï¼Œä¸éœ€è¦å¼€æ”¾ç«¯å£
```

**æ³¨æ„**ï¼šå¦‚æœä½¿ç”¨ SSH ç«¯å£è½¬å‘ï¼Œè¿œç¨‹æœåŠ¡å™¨**ä¸éœ€è¦**å¼€æ”¾ 5678 ç«¯å£ã€‚

---

### æ­¥éª¤ 6ï¼šéªŒè¯è·¯å¾„æ˜ å°„

**æ£€æŸ¥ `.vscode/launch.json` ä¸­çš„è·¯å¾„æ˜ å°„ï¼š**

```json
{
    "name": "Python: Remote Attach (SSH Tunnel)",
    "pathMappings": [
        {
            "localRoot": "${workspaceFolder}",
            "remoteRoot": "/root/MyAgent"  // ç¡®ä¿è¿™ä¸ªè·¯å¾„æ­£ç¡®
        }
    ]
}
```

**éªŒè¯è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„å®é™…è·¯å¾„ï¼š**

```bash
# åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Š
pwd  # åº”è¯¥æ˜¯ /root/MyAgent
ls -la  # ç¡®è®¤æ–‡ä»¶å­˜åœ¨
```

---

## ğŸ› ï¸ å®Œæ•´æ£€æŸ¥æ¸…å•

### åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼š

- [ ] debugpy å·²å®‰è£…ï¼š`pipenv list | grep debugpy`
- [ ] åº”ç”¨æ­£åœ¨è¿è¡Œï¼š`ps aux | grep uvicorn`
- [ ] ç«¯å£ 5678 åœ¨ç›‘å¬ï¼š`netstat -tuln | grep 5678`
- [ ] å¯åŠ¨æ—¥å¿—æ˜¾ç¤º "ç›‘å¬ç«¯å£ 5678"

### åœ¨æœ¬åœ°ï¼š

- [ ] SSH éš§é“å·²å»ºç«‹ï¼š`ps aux | grep "5678:localhost:5678"`
- [ ] æœ¬åœ°ç«¯å£å¯è®¿é—®ï¼š`nc -zv localhost 5678`
- [ ] launch.json é…ç½®æ­£ç¡®

---

## ğŸ”„ å¿«é€Ÿä¿®å¤å‘½ä»¤

### æ–¹æ¡ˆ 1ï¼šå®Œæ•´é‡å¯æµç¨‹

**è¿œç¨‹æœåŠ¡å™¨ï¼š**
```bash
# 1. åœæ­¢ç°æœ‰è¿›ç¨‹
pkill -f uvicorn
pkill -f python

# 2. è¿›å…¥é¡¹ç›®ç›®å½•
cd /root/MyAgent

# 3. ç¡®è®¤ .env å­˜åœ¨
cat .env

# 4. å¯åŠ¨åº”ç”¨ï¼ˆè°ƒè¯•æ¨¡å¼ï¼‰
export ENABLE_REMOTE_DEBUG=1
python start_with_debug.py &
```

**æœ¬åœ°ï¼š**
```bash
# 1. åœæ­¢ç°æœ‰ SSH éš§é“
pkill -f "5678:localhost:5678"

# 2. å»ºç«‹æ–°çš„ SSH éš§é“
ssh -f -N -L 5678:localhost:5678 root@192.168.189.246 -p 20022

# 3. éªŒè¯
nc -zv localhost 5678
```

**Cursorï¼š**
- è®¾ç½®æ–­ç‚¹
- æŒ‰ F5
- é€‰æ‹© "Python: Remote Attach (SSH Tunnel)"

### æ–¹æ¡ˆ 2ï¼šä½¿ç”¨ä¸åŒçš„è°ƒè¯•ç«¯å£

å¦‚æœ 5678 è¢«å ç”¨ï¼Œä½¿ç”¨å…¶ä»–ç«¯å£ï¼š

**è¿œç¨‹æœåŠ¡å™¨ï¼š**
```bash
export DEBUG_PORT=5679
export ENABLE_REMOTE_DEBUG=1
python start_with_debug.py
```

**æœ¬åœ°ï¼š**
```bash
# æ›´æ–° SSH éš§é“ç«¯å£
ssh -f -N -L 5679:localhost:5679 root@192.168.189.246 -p 20022
```

**æ›´æ–° `.vscode/launch.json`ï¼š**
```json
{
    "connect": {
        "host": "localhost",
        "port": 5679  // æ”¹ä¸ºæ–°ç«¯å£
    }
}
```

---

## ğŸ“‹ è¯Šæ–­è„šæœ¬

åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè¿è¡Œè¿™ä¸ªè„šæœ¬æ¥æ£€æŸ¥æ‰€æœ‰é…ç½®ï¼š

```bash
cat > /root/MyAgent/check_debug.sh << 'EOF'
#!/bin/bash
echo "=== è°ƒè¯•ç¯å¢ƒæ£€æŸ¥ ==="
echo ""
echo "1. æ£€æŸ¥ debugpy å®‰è£…ï¼š"
pipenv list | grep debugpy || pip list | grep debugpy || echo "âŒ debugpy æœªå®‰è£…"
echo ""
echo "2. æ£€æŸ¥ Python è¿›ç¨‹ï¼š"
ps aux | grep -E "(uvicorn|python|start_with_debug)" | grep -v grep
echo ""
echo "3. æ£€æŸ¥ç«¯å£ 5678ï¼š"
netstat -tuln | grep 5678 || ss -tuln | grep 5678 || echo "âŒ ç«¯å£ 5678 æœªç›‘å¬"
echo ""
echo "4. æ£€æŸ¥ .env æ–‡ä»¶ï¼š"
[ -f .env ] && echo "âœ… .env å­˜åœ¨" || echo "âŒ .env ä¸å­˜åœ¨"
echo ""
echo "5. æ£€æŸ¥é¡¹ç›®æ–‡ä»¶ï¼š"
ls -la app/main.py && echo "âœ… é¡¹ç›®æ–‡ä»¶å­˜åœ¨" || echo "âŒ é¡¹ç›®æ–‡ä»¶ç¼ºå¤±"
EOF

chmod +x /root/MyAgent/check_debug.sh
/root/MyAgent/check_debug.sh
```

---

## ğŸ’¡ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆè¿æ¥è¢«æ‹’ç»ï¼Ÿ

**A:** å¯èƒ½çš„åŸå› ï¼š
1. è¿œç¨‹æœåŠ¡å™¨ä¸Šçš„ debugpy æ²¡æœ‰å¯åŠ¨
2. SSH éš§é“æ²¡æœ‰å»ºç«‹
3. ç«¯å£è¢«å…¶ä»–ç¨‹åºå ç”¨
4. é˜²ç«å¢™é˜»æ­¢è¿æ¥

### Q: å¦‚ä½•ç¡®è®¤ debugpy æ­£åœ¨è¿è¡Œï¼Ÿ

**A:** åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼š
```bash
# æ–¹æ³•1ï¼šæ£€æŸ¥ç«¯å£
netstat -tuln | grep 5678

# æ–¹æ³•2ï¼šæ£€æŸ¥è¿›ç¨‹
ps aux | grep debugpy

# æ–¹æ³•3ï¼šæŸ¥çœ‹å¯åŠ¨æ—¥å¿—
# åº”è¯¥çœ‹åˆ° "ç›‘å¬ç«¯å£ 5678" æˆ– "Listening on..."
```

### Q: SSH éš§é“å¦‚ä½•éªŒè¯ï¼Ÿ

**A:** åœ¨æœ¬åœ°ï¼š
```bash
# æ£€æŸ¥è¿›ç¨‹
ps aux | grep "5678:localhost:5678"

# æµ‹è¯•è¿æ¥
nc -zv localhost 5678
```

### Q: å¯ä»¥åŒæ—¶è°ƒè¯•å¤šä¸ªè¿›ç¨‹å—ï¼Ÿ

**A:** å¯ä»¥ï¼Œä½†éœ€è¦ä¸åŒçš„ç«¯å£ï¼š
- ä¸»åº”ç”¨ï¼š5678
- Celery Workerï¼š5679
- å…¶ä»–æœåŠ¡ï¼š5680

---

## ğŸš€ æ¨èçš„å·¥ä½œæµç¨‹

1. **è¿œç¨‹æœåŠ¡å™¨**ï¼šå¯åŠ¨åº”ç”¨ï¼ˆå¸¦è°ƒè¯•ï¼‰
   ```bash
   cd /root/MyAgent
   export ENABLE_REMOTE_DEBUG=1
   python start_with_debug.py
   ```

2. **æœ¬åœ°**ï¼šå»ºç«‹ SSH éš§é“ï¼ˆåå°è¿è¡Œï¼‰
   ```bash
   ssh -f -N -L 5678:localhost:5678 root@192.168.189.246 -p 20022
   ```

3. **æœ¬åœ°**ï¼šéªŒè¯è¿æ¥
   ```bash
   nc -zv localhost 5678
   ```

4. **Cursor**ï¼šå¯åŠ¨è°ƒè¯•å™¨
   - F5 â†’ "Python: Remote Attach (SSH Tunnel)"

---

## ğŸ“ å¦‚æœè¿˜æ˜¯ä¸è¡Œ

1. **æ£€æŸ¥è¿œç¨‹æœåŠ¡å™¨æ—¥å¿—**ï¼šæŸ¥çœ‹å¯åŠ¨è„šæœ¬çš„è¾“å‡º
2. **æ£€æŸ¥ SSH è¿æ¥**ï¼šç¡®ä¿å¯ä»¥æ­£å¸¸ SSH åˆ°æœåŠ¡å™¨
3. **æ£€æŸ¥ Python ç‰ˆæœ¬**ï¼šç¡®ä¿è¿œç¨‹æœåŠ¡å™¨ Python ç‰ˆæœ¬ >= 3.8
4. **æ£€æŸ¥ debugpy ç‰ˆæœ¬**ï¼š`pipenv list | grep debugpy`

æä¾›ä»¥ä¸‹ä¿¡æ¯ä»¥ä¾¿è¿›ä¸€æ­¥æ’æŸ¥ï¼š
- è¿œç¨‹æœåŠ¡å™¨ä¸Š `netstat -tuln | grep 5678` çš„è¾“å‡º
- æœ¬åœ° `ps aux | grep "5678"` çš„è¾“å‡º
- è¿œç¨‹æœåŠ¡å™¨ä¸Šåº”ç”¨å¯åŠ¨çš„æ—¥å¿—

